<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas</title>
    <style>
        #movimentar1 {
            border: 1px solid black;
            background-color: lightgray;
        }
        #adicionarBola {
            margin-top: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div>   
        <h2>Movimentar Bolinhas no Canvas</h2>

        <input type="text" id="qtdbolinha" placeholder="Quantidade de Bolinhas" value="5">
        <button id="adicionarBola">Adicionar Bolinha</button>
    </div>
    
    <canvas id="movimentar1" width="790" height="590">
        <h3>Seu navegador não suporta o elemento <code>canvas</code>.</h3>
        <!--Caso o canvas não seja suportado, você pode fornecer uma alternativa aqui-->
    </canvas>

    <script>
        const canvas = document.getElementById('movimentar1');
        const ctx = canvas.getContext('2d');

        let anima;
        const bolinhas = [];

        const adicionarBolaBtn = document.getElementById('adicionarBola');
        
        adicionarBolaBtn.onclick = () => {
            cancelAnimationFrame(anima); // para a animação atual
            bolinhas.length = 0; // limpa o array de bolinhas
            const qtd = document.getElementById('qtdbolinha').value; // quantidade de bolinhas
            const cores = ['blue', 'red', 'green', 'orange', 'purple', 'black', 'yellow', 'pink'];
            // cria bolinhas automaticamente
            for (let i = 0; i < qtd; i++) {
                const raio = 15 + Math.random() * 35; // tamanho entre 15 a 50 px
                const posx = Math.random() * (canvas.width - 2 * raio) + raio;
                const posy = Math.random() * (canvas.height - 2 * raio) + raio;
                const angulo = Math.random() * Math.PI * 2;
                const velocidade = 3 + Math.random() * 3; //Gera um velocidade entre 3 a 6
                bolinhas.push({
                    x: posx,
                    y: posy,
                    r: raio,
                    vx: Math.cos(angulo) * velocidade,
                    vy: Math.sin(angulo) * velocidade,
                    color: cores[i % cores.length]
                });
            }
            movimetar(); // reinicia a animação
        };

        

        // cria bolinhas automaticamente
        for (let i = 0; i < qtd; i++) {
            const raio = 15 + Math.random() * 35; // tamanho entre 15 a 50 px
            const posx = Math.random() * (canvas.width - 2 * raio) + raio;
            const posy = Math.random() * (canvas.height - 2 * raio) + raio;
            const angulo = Math.random() * Math.PI * 2;
            const velocidade = 3 + Math.random() * 3; //Gera um velocidade entre 3 a 6
            bolinhas.push({
                x: posx,
                y: posy,
                r: raio,
                vx: Math.cos(angulo) * velocidade,
                vy: Math.sin(angulo) * velocidade,
                color: cores[i % cores.length]
            });
        }

        function movimetar() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpa o canvas

            for (const b of bolinhas) {
                // desenha
                ctx.beginPath();// Inicia um novo caminho
                ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
                ctx.fillStyle = b.color;
                ctx.fill();

                // atualiza posição
                b.x += b.vx;
                b.y += b.vy;

                // colisão com paredes (rebote)
                if (b.x + b.r > canvas.width) {
                    b.x = canvas.width - b.r;
                    b.vx *= -1;
                }
                if (b.x - b.r < 0) {
                    b.x = b.r;
                    b.vx *= -1;
                }
                if (b.y + b.r > canvas.height) {
                    b.y = canvas.height - b.r;
                    b.vy *= -1;
                }
                if (b.y - b.r < 0) {
                    b.y = b.r;
                    b.vy *= -1;
                }
            }

            anima = requestAnimationFrame(movimetar);
        }

        // inicia quando o DOM estiver pronto
        window.addEventListener('DOMContentLoaded', movimetar);
    </script>


</body>

</html>